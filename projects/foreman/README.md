# Notes about Foreman

Foreman is a very special project for Petronia.  It's the entry-program for starting up Petronia, and keeps it going.


## For Developers

As Foreman is critical to keeping the primary security, safety, and reliability of Petronia, it must be carefully updated.

* Where possible, it should minimize platform knowledge.
* It is the root of all events and runs outside of extensions.  It can have no explicit knowledge of other extensions except the extension loader.
    * Because of this, Foreman must be extremely careful about using the `py-extension-lib` project.  Logging, timer, data store, and other normally "just there" extensions can't be assumed to be running, and these events cannot be used.


### Event Passing

Even for experienced developers, tracing the events through Foreman is tricky.  Events are only passed through binary streams (even for in-process extensions), events can only be passed between extensions through an allow-list registration, and Foreman attempts to optimize the event passing.

To help with event pass tracing, the `user_message.trace_event` function should be invoked when an event is received or an event decision is made.

The launchers register a *channel* when an extension is launched.  The channel for an extension manages the byte stream read and write access for the extension; it *reads* events *generated* by the extension, and *writes* events that the extension *listens to*.  Other extensions can listen to events generated by adding listeners to the source extension's channel.
