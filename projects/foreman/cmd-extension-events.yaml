---

name: petronia.internal.extension_commands
type: api
version: [1, 0, 0]
about: Internal communication between a cmd launcher and an executable.
description: >
  These are additional events used internally between a command launcher
  category and the launched executable channel.  This definition is only
  used for automating the construction of the code to manage these events,
  but are never used by an extension itself.
licenses:
  - MIT
authors:
  - Petronia Project
default:
  name: petronia.internal.never_implemented
  minimum: [1000, 0, 0]


events:
  "internal-load-extension:request":
    description: >
      Request for an extension be loaded into the launched executable.  Sent only
      by the launcher category in Foreman.  It is up to the executable to determine
      how to find the extension.
    priority: io
    send-access: internal
    receive-access: implementations
    fields:
      name:
        description: The fully qualified extension name to load.
        type: string
      version:
        description: >
          The precise version to load.
        type: reference
        ref: version
      configuration:
        description: >
          User configuration for the extension.  This is a JSON data object stored in a
          string value.
        optional: true
        type: string
        min-length: 0
        max-length: 65535

  "internal-load-extension:failed":
    description: >
      Loading the extension failed.
    priority: normal
    send-access: implementations
    receive-access: target
    fields:
      name:
        description: The extension requested to load which failed.
        type: string
      error:
        type: reference
        ref: error

  "internal-load-extension:success":
    description: >
      The request to load the extension succeeded.  Other events related to the extension loading
      may be sent, but that is in a different life cycle.
    priority: normal
    send-access: implementations
    receive-access: target
    fields:
      name:
        description: The loaded extension name.
        type: string
      version:
        description: The loaded extension version.
        type: reference
        ref: version

references:
  version:
    type: array
    min-length: 3
    max-length: 3
    value-type:
      type: int
  error:
    type: structure
    description: A failure
    fields:
      identifier:
        type: string
        min-length: 2
        max-length: 255
        description: The identifier that uniquely defines this error.
      source:
        type: string
        optional: true
        description: The source of the error, if known.
      message:
        type: string
        description: A localizable message.
      arguments:
        type: array
        description: arguments for the message.
        value-type:
          type: selector
          type-mapping:
            string:
              type: string
            int:
              type: int
            float:
              type: float
