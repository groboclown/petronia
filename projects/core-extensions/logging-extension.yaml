---

name: petronia.core.protocol.logging
type: protocol
version: [1, 0, 0]
about: Logging API, and includes a standard for public error messages.
description: >
  A common API for logging messages and reporting errors.

  This is a protocol, so there doesn't need to be an implementation, and
  it doesn't need to be loaded.  This allows for core extensions to
  log messages without creating a dependency cycle.
licenses:
  - MIT
authors:
  - Petronia Project


events:
  "log":
    description: >
      A request to log a message.  This can be publicly received, so that any extension
      can listen to logging messages.  For this reason, nothing private should be sent.
    priority: io
    send-access: public
    receive-access: public
    unique-target: log
    fields:
      scope:
        type: enum
        values:
          - warning
          - info
          - verbose
          - debug
      messages:
        type: array
        min-length: 1
        max-length: 100
        value-type:
          type: reference
          ref: localizable-message

  system-error:
    description: >
      Report an error that's caused by Petronia itself (or an extension), rather than something
      the user did.
    priority: io
    send-access: public
    receive-access: public
    unique-target: error
    fields:
      error:
        type: reference
        ref: error

  user-error:
    description: >
      Report an error that's caused by the end user, such as a mis-configuration or out-of-disk space.
    priority: io
    send-access: public
    receive-access: public
    unique-target: error
    fields:
      user_error:
        type: reference
        ref: error


references:
  error:
    type: structure
    description: A description of a failure.
    fields:
      identifier:
        description: >
          The identifier that uniquely defines this error.  Useful for
          automation that needs to perform operations based on specific
          error messages.
        type: string
        min-length: 5
        max-length: 600
      categories:
        description: >
          A collection of general categories that define the error.
          Useful for automation that can act differently depending on
          the contents.
        type: array
        min-length: 1
        max-length: 100
        value-type:
            type: enum
            values:
              - file
              - os
              - configuration
              - network
              - access-restriction
              - invalid-user-action
              - internal
      source:
        description: The source of the error, if known.
        type: string
        min-length: 2
        max-length: 300
        optional: true
      messages:
        description: The localizable messages associated with this error.
        type: array
        min-length: 1
        max-length: 100
        value-type:
            type: reference
            ref: localizable-message
  localizable-message:
    description: A localizable message for user display.
    type: structure
    fields:
      catalog:
        description: >
          The name of the translation file, or "domain", that contains
          the translations.
        type: string
        min-length: 2
        max-length: 300
      message:
        description: >
          The message ID to look up in the catalog.  If the message
          has no translation, this is directly displayed to the user.
        type: string
        min-length: 1
        max-length: 10000
      arguments:
        description: >
          List of arguments to be inserted into the translated message.
          Each argument should have a distinct name from all the other
          arguments in this message; the name is how the message references
          the arguments.
        type: array
        min-length: 0
        max-length: 100
        optional: true
        value-type:
          type: reference
          ref: message-argument
  message-argument:
    description: An argument to be inserted into the localizable message.
    type: structure
    fields:
      name:
        description: Name of the arugment, referenced by the message.
        type: string
        min-length: 1
        max-length: 50
      value:
        description: Value of the argument.  It must be a simple type.
        type: reference
        ref: message-argument-value
  message-argument-value:
    description: A replacement value for a named argument in the message.
    type: selector
    type-mapping:
      string:
        type: string
        min-length: 0
        max-length: 10000
      int:
        type: int
      float:
        type: float
      bool:
        type: bool
      datetime:
        type: datetime
      string_list:
        type: array
        min-length: 0
        max-length: 100
        value-type:
          type: string
          min-length: 0
          max-length: 10000
      int_list:
        type: array
        min-length: 0
        max-length: 100
        value-type:
          type: int
      float_list:
        type: array
        min-length: 0
        max-length: 100
        value-type:
          type: float
      bool_list:
        type: array
        min-length: 0
        max-length: 100
        value-type:
          type: bool
      datetime_list:
        type: array
        min-length: 0
        max-length: 100
        value-type:
          type: datetime
